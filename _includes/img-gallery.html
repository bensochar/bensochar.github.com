
<!-- _includes/img-gallery.html -->
{% assign img_path = page.url | replace: '/projects/','' | downcase %}
{% assign col_total = 0 %}
{% assign project_imgs = '' | split: ',' %}
{% for image in site.static_files %}
  <!-- if image path matches url -->
  {% if image.path contains img_path %}
    <!-- we need to check for webp files, jpgs & gifs -->
    {% unless image.extname == '.webp' or image.path contains '.low' %}
        <!-- we need to check for the 'low source' -->
        {% assign img_file = image.path %}
        <!-- Making sure the array is unique -->
        {% unless img_file == previous_img_file %}
          {% assign project_imgs = project_imgs | push: image %}
        {% endunless %}
      {% assign previous_img_file = img_file %}
    {% endunless %}
  {% endif %}
{% endfor %}

<div class="clearfix"></div>
<div class="container">
  <div class="row text-center">
    <div class="clearfix"></div>
    <div id="js-gallery-project" class="clearfix js-gallery-project gallery-project">
    {% for img in project_imgs %}
        {% assign show_image = true %}
        {% comment %}

        {% endcomment %}

        {% assign img_name        = img.path | replace: '.jpg', '' | replace: '.gif', '' | replace: '.png', '' %}
        {% assign img_low         = img_name | append: '.low'  %}
        {% assign img_screen      = img_name | replace: '.nochrome', '' | slice: -3,3 %}
        {% assign img_caption     = '' %}
        {% assign img_caption     = img_name | split: '/'  %}
        {% assign img_caption     = img_caption.last | replace: img_screen,'' | replace: '1','' | replace: '2','' | replace: '-',' ' | replace: '.nochrome', ''  %}

        {% assign webp_file       = img_name | prepend: site.baseurl | append: '.webp' %}
        {% assign webp_file_low   = img_name | prepend: site.baseurl | append: '.low' | append: '.webp' %}
        {% assign jpg_file        = img.path | prepend: site.baseurl %}
        {% assign jpg_file_low    = img_name | prepend: site.baseurl | append: '.low' | append: img.extname %}

        {% if img_screen == '-lg' %}
          {% assign img_width = 1680 %}
          {% assign col_width = 8 %}
          {% assign chrome_height = 75 %}
        {% elsif img_screen == '-md' %}
          {% assign img_width = 1024 %}
          {% assign col_width = 6 %}
          {% assign chrome_height = 65 %}
        {% elsif img_screen == '-sm' %}
          {% assign img_width = 768 %}
          {% assign col_width = 5 %}
          {% assign chrome_height = 65 %}
        {% elsif img_screen == '-xs' %}
          {% assign img_width = 360 %}
          {% assign col_width = 4 %}
          {% assign chrome_height = 73 %}
        {% else %}
          {% assign show_image = false %}
        {% endif %}

        {% assign col_total = col_total | plus: col_width %}

        {% if forloop.last %}
        {% assign offset = 24 | minus: col_total | divided_by: 2 %}
        <!--
        <h1>{{ col_total }} Last</h1>
        <h1>{{ offset }} Last</h1>
        -->
        {% endif %}
        {% if show_image %}
        <div class="col-xs-24 col-sm-{{col_width}} col-md-{{col_width}} gallery-project-item gallery-project-item{{img_screen}}" style="">
          <figure class="gallery-project-figure">
            {% if img.path contains '.nochrome' %}
            {% else %}
            <picture class="gallery-project-chrome gallery-project-chrome{{img_screen}}">
              <source srcset="{{ site.baseurl }}/assets/images/{{ img_screen | prepend: 'browser-chrome' | append: '.webp' }}" type="image/webp">
              <img src="{{ site.baseurl }}/assets/images/{{ img_screen | prepend: 'browser-chrome' | append: '.png' }}" class="img-responsive" width="{{ img_width }}" height="{{ chrome_height }}">
            </picture>
            {% endif %}
            <picture>
              <source srcset="{{ webp_file_low }}" data-src="{{ webp_file }}" data-src-retina="{{ webp_file }}" type="image/webp">
              <img src="{{ jpg_file_low }}" data-src="{{ jpg_file }}" data-src-retina="{{ jpg_file }}" alt="{{ img_caption | capitalize }}" class="img-responsive" width="{{img_width}}">
              <noscript>
                <source srcset="{{ webp_file }}" type="image/webp">
                <img src="{{ jpg_file  }}" alt="{{ img_caption | capitalize }}" class="img-responsive" width="{{img_width}}">
              </noscript>
            </picture>
            <figcaption>{{ img_caption | trim | capitalize }}</figcaption>
          </figure>
        </div>
        {% endif %}
    {% endfor %}
    </div>
    <div class="clearfix"></div>
  </div>
</div>